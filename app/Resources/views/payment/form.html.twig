<p>Votre place coute {{ ticketPrice.formatted }}. Ce prix n'est valable qu'en prévente, alors dépéchez-vous !</p>

<p>
    Veuillez noter que vous ne pouvez payer votre t-shirt sur ce site qu'en même temps que votre ticket.
    Sinon, vous pourrez toujours l'acheter le jour de la LAN (dans la limite des stocks disponibles).
</p>

<noscript>
    <p>Vous devez avoir Javascript d'activé pour pouvoir payer votre place</p>
</noscript>

{{ form_start(paymentForm) }}
    <div>
        {{ form_errors(paymentForm.tshirt) }}
        <label class="tshirt_checkbox">
            {{ form_widget(paymentForm.tshirt) }}
            Voulez-vous réserver un tshirt ? Il coute {{ tshirtPrice.formatted }}.
        </label>
    </div>
    <div id="tshirtData" style="display: none">
        {{ form_row(paymentForm.tshirtSize) }}
        {{ form_row(paymentForm.tshirtGender) }}
    </div>
    <button id="pay">Payer</button>
{{ form_end(paymentForm) }}
<script src="https://checkout.stripe.com/checkout.js"></script>
<script>
    var stripeButton = $('#pay');
    var tshirtData = $('#tshirtData');
    var checkbox = $("input[type=checkbox]");
    var gender = $('input[name="payment[tshirtGender]"]');
    var size = $('input[name="payment[tshirtSize]"]');
    var amount = {{ ticketPrice.amount }};
    checkbox.on('ifChecked', function () {
        tshirtData.show();
        amount = {{ tshirtPrice.amount + ticketPrice.amount }};
    });

    checkbox.on('ifUnchecked', function () {
        tshirtData.hide();
        amount = {{ ticketPrice.amount }};
    });

    stripeButton.on('click', function(e) {
        if (checkbox.is(':checked') && (!gender.is(':checked') || !size.is(':checked'))) {
            e.preventDefault();
            noty({timeout: 10000,
                layout: 'topRight',
                text: 'Vous devez choisir une taille et une coupe', 'type': 'error'});
            return;
        }
        StripeCheckout.open({
            key: '{{ key }}',
            image: '{{ asset('img/logo.png') }}',
            name: 'UTT Arena',
            description: 'Place pour la LAN',
            currency: 'EUR',
            panelLabel: 'Payer {% verbatim %}{{amount}}{% endverbatim %}',
            allowRememberMe: false,
            amount: amount,
            billingAddress: true,
            zipCode: true,
            token: function(token) {
                var $input = $('<input type=hidden name=stripeToken />').val(token.id);
                $('form').append($input).submit();
            }
        });
        e.preventDefault();
    });

    // Close Checkout on page navigation
    $(window).on('popstate', function() {
        handler.close();
    });
</script>